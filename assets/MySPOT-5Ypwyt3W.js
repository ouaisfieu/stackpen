import{r as n,s as T,j as e,D as xe,U as Ce}from"./index-KgKUpajO.js";const te={person:"ðŸ‘¤",org:"ðŸ¢",place:"ðŸ“",event:"ðŸ“…",object:"ðŸ”®",document:"ðŸ“„"},Se={person:"#4da6ff",org:"#a78bfa",place:"#4ade80",event:"#fbbf24",object:"#f472b6",document:"#6b7894"},we={ally:"#4ade80",adversary:"#f87171",target:"#fbbf24",undecided:"#6b7894"},re=[{value:"person",label:"Personne",icon:"ðŸ‘¤"},{value:"org",label:"Organisation",icon:"ðŸ¢"},{value:"place",label:"Lieu",icon:"ðŸ“"},{value:"event",label:"Evenement",icon:"ðŸ“…"},{value:"object",label:"Objet",icon:"ðŸ”®"},{value:"document",label:"Document",icon:"ðŸ“„"}],ce=[{value:"",label:"â€” Aucun â€”"},{value:"ally",label:"Allie",icon:"âœ…"},{value:"adversary",label:"Adversaire",icon:"âŒ"},{value:"target",label:"Cible",icon:"ðŸŽ¯"},{value:"undecided",label:"Indecis",icon:"â“"}],be=[{id:"research",emoji:"ðŸ”¬",name:"Recherche",desc:"Etudes, donnees, preuves"},{id:"mobilization",emoji:"âœŠ",name:"Mobilisation",desc:"Manifestations, petitions"},{id:"legal",emoji:"âš–ï¸",name:"Action juridique",desc:"Proces, recours"},{id:"opposition",emoji:"ðŸš«",name:"Opposition",desc:"Blocage, resistance"},{id:"boycott",emoji:"ðŸ›’",name:"Boycott",desc:"Pression economique"},{id:"negotiation",emoji:"ðŸ¤",name:"Negociation",desc:"Dialogue, compromis"},{id:"petition",emoji:"ðŸ“",name:"Petition",desc:"Signatures, soutien"},{id:"lobbying",emoji:"ðŸ›ï¸",name:"Lobbying",desc:"Influence politique"},{id:"alliance",emoji:"ðŸ”—",name:"Alliance",desc:"Coalitions, partenariats"},{id:"media",emoji:"ðŸ“°",name:"Medias",desc:"Presse, communication"},{id:"education",emoji:"ðŸ“š",name:"Education",desc:"Sensibilisation, formation"},{id:"digital",emoji:"ðŸ’»",name:"Numerique",desc:"Reseaux sociaux, viral"}],fe={"-2":"Fortement oppose","-1":"Plutot oppose",0:"Neutre",1:"Plutot favorable",2:"Fortement favorable"},je={"-2":"--","-1":"-",0:"â—‹",1:"+",2:"++"},ve=[{value:"none",label:"Aucun"},{value:"indirect",label:"Indirect"},{value:"direct",label:"Direct"}],pe=[{value:"planned",label:"Planifie"},{value:"ongoing",label:"En cours"},{value:"completed",label:"Termine"}],ue={toc:{vision:"",values:"",hypotheses:"",missions:""},swot:{strengths:[],weaknesses:[],opportunities:[],threats:[]},pestel:{political:"",economic:"",social:"",tech:"",env:"",legal:""},tree:{problem:"",causes:[],consequences:[]},fiveWhy:["","","","","",""],objectives:[],strategies:[],messages:[],targets:[],progress:[],actions:[]},ie=()=>"id_"+Math.random().toString(36).substr(2,9)+Date.now().toString(36);function ke(){const[t,c]=n.useState([]),[a,l]=n.useState([]),[i,j]=n.useState([]),[b,s]=n.useState(ue),[m,p]=n.useState(!0),[r,d]=n.useState(null),h=n.useCallback(async()=>{p(!0);try{const[u,y,w,D]=await Promise.all([T.from("spot_entities").select("*").order("created_at",{ascending:!1}),T.from("spot_relations").select("*"),T.from("spot_notes").select("*").order("created_at",{ascending:!1}),T.from("spot_plaidoyer").select("*").maybeSingle()]);if(u.error)throw u.error;if(y.error)throw y.error;if(w.error)throw w.error;c(u.data||[]),l(y.data||[]),j(w.data||[]),D.data?.data&&s({...ue,...D.data.data})}catch(u){console.error("Error loading data:",u),d(u.message)}finally{p(!1)}},[]);n.useEffect(()=>{h()},[h]);const S=n.useCallback(async u=>{const y={id:ie(),...u,tags:u.tags||[],created_at:new Date().toISOString()},{error:w}=await T.from("spot_entities").insert(y);if(w)throw w;return c(D=>[y,...D]),y},[]),R=n.useCallback(async(u,y)=>{const{error:w}=await T.from("spot_entities").update(y).eq("id",u);if(w)throw w;c(D=>D.map(F=>F.id===u?{...F,...y}:F))},[]),P=n.useCallback(async u=>{const{error:y}=await T.from("spot_relations").delete().or(`from_entity.eq.${u},to_entity.eq.${u}`);if(y)throw y;const{error:w}=await T.from("spot_notes").delete().eq("entity_id",u);if(w)throw w;const{error:D}=await T.from("spot_entities").delete().eq("id",u);if(D)throw D;c(F=>F.filter(J=>J.id!==u)),l(F=>F.filter(J=>J.from_entity!==u&&J.to_entity!==u)),j(F=>F.filter(J=>J.entity_id!==u))},[]),O=n.useCallback(async u=>{const y={id:ie(),from_entity:u.from,to_entity:u.to,type:u.type,created_at:new Date().toISOString()},{error:w}=await T.from("spot_relations").insert(y);if(w)throw w;return l(D=>[...D,y]),y},[]),N=n.useCallback(async(u,y)=>{const w={from_entity:y.from,to_entity:y.to,type:y.type},{error:D}=await T.from("spot_relations").update(w).eq("id",u);if(D)throw D;l(F=>F.map(J=>J.id===u?{...J,...w}:J))},[]),f=n.useCallback(async u=>{const{error:y}=await T.from("spot_relations").delete().eq("id",u);if(y)throw y;l(w=>w.filter(D=>D.id!==u))},[]),E=n.useCallback(async u=>{const y={id:ie(),entity_id:u.entityId,content:u.content,source:u.source||null,created_at:new Date().toISOString()},{error:w}=await T.from("spot_notes").insert(y);if(w)throw w;return j(D=>[y,...D]),y},[]),g=n.useCallback(async(u,y)=>{const{error:w}=await T.from("spot_notes").update(y).eq("id",u);if(w)throw w;j(D=>D.map(F=>F.id===u?{...F,...y}:F))},[]),k=n.useCallback(async u=>{const{error:y}=await T.from("spot_notes").delete().eq("id",u);if(y)throw y;j(w=>w.filter(D=>D.id!==u))},[]),C=n.useCallback(async u=>{const{data:y}=await T.from("spot_plaidoyer").select("id").maybeSingle();if(y){const{error:w}=await T.from("spot_plaidoyer").update({data:u,updated_at:new Date().toISOString()}).eq("id",y.id);if(w)throw w}else{const{error:w}=await T.from("spot_plaidoyer").insert({id:ie(),data:u,created_at:new Date().toISOString()});if(w)throw w}s(u)},[]),_=n.useCallback(async(u,y,w)=>{const D={...b};D[u]||(D[u]={}),D[u][y]=w,await C(D)},[b,C]),q=n.useCallback(()=>({entities:t.map(u=>({id:u.id,name:u.name,type:u.type,alias:u.alias,desc:u.desc,date:u.date,role:u.role,tags:u.tags})),relations:a.map(u=>({id:u.id,from:u.from_entity,to:u.to_entity,type:u.type})),notes:i.map(u=>({id:u.id,entityId:u.entity_id,content:u.content,source:u.source})),plaidoyer:b}),[t,a,i,b]),M=n.useCallback(async u=>{let y={entities:0,relations:0,notes:0};if(u.entities?.length)for(const w of u.entities)t.find(F=>F.id===w.id)||(await S(w),y.entities++);if(u.relations?.length)for(const w of u.relations)a.find(F=>F.id===w.id)||(await O(w),y.relations++);if(u.notes?.length)for(const w of u.notes)i.find(F=>F.id===w.id)||(await E(w),y.notes++);if(u.plaidoyer){const w={...b,...u.plaidoyer};await C(w)}return y},[t,a,i,b,S,O,E,C]),U=n.useCallback(async()=>{await T.from("spot_notes").delete().neq("id",""),await T.from("spot_relations").delete().neq("id",""),await T.from("spot_entities").delete().neq("id",""),await T.from("spot_plaidoyer").delete().neq("id",""),c([]),l([]),j([]),s(ue)},[]),Y=n.useCallback(u=>a.filter(y=>y.from_entity===u||y.to_entity===u),[a]),G=n.useCallback(u=>i.filter(y=>y.entity_id===u),[i]),Z=n.useCallback(u=>t.find(y=>y.id===u),[t]),Q=n.useCallback(()=>{const u={},y={ally:0,adversary:0,target:0,undecided:0};return t.forEach(w=>{u[w.type]=(u[w.type]||0)+1,w.role&&y[w.role]++}),{totalEntities:t.length,totalRelations:a.length,totalNotes:i.length,byType:u,byRole:y}},[t,a,i]);return{entities:t,relations:a,notes:i,plaidoyer:b,loading:m,error:r,addEntity:S,updateEntity:R,deleteEntity:P,addRelation:O,updateRelation:N,deleteRelation:f,addNote:E,updateNote:g,deleteNote:k,savePlaidoyer:C,updatePlaidoyerField:_,exportData:q,importData:M,resetData:U,getEntityRelations:Y,getEntityNotes:G,getEntityById:Z,getStats:Q,reload:h}}function Ee({entities:t,selectedId:c,onSelect:a,onAdd:l}){const[i,j]=n.useState(""),[b,s]=n.useState(""),m=n.useRef(null),p=n.useMemo(()=>{let d=t;return i&&(d=d.filter(h=>h.type===i)),b&&(d=d.filter(h=>h.role===b)),d},[t,i,b]),r=n.useCallback((d,h)=>{const S=m.current?.querySelectorAll('[role="option"]');if(!S)return;let R=h;switch(d.key){case"ArrowDown":d.preventDefault(),R=Math.min(h+1,S.length-1);break;case"ArrowUp":d.preventDefault(),R=Math.max(h-1,0);break;case"Home":d.preventDefault(),R=0;break;case"End":d.preventDefault(),R=S.length-1;break;default:return}S[R]?.focus()},[]);return e.jsxs("div",{className:"spot-panel spot-entity-list-panel",children:[e.jsxs("div",{className:"spot-panel-header",children:[e.jsx("h2",{className:"spot-panel-title",id:"entity-list-title",children:"Entites"}),e.jsxs("div",{className:"spot-filter-row",children:[e.jsxs("select",{className:"spot-filter-select",value:i,onChange:d=>j(d.target.value),"aria-label":"Filtrer par type",children:[e.jsx("option",{value:"",children:"Tous types"}),re.map(d=>e.jsxs("option",{value:d.value,children:[d.label,"s"]},d.value))]}),e.jsxs("select",{className:"spot-filter-select",value:b,onChange:d=>s(d.target.value),"aria-label":"Filtrer par role",children:[e.jsx("option",{value:"",children:"Tous roles"}),ce.filter(d=>d.value).map(d=>e.jsxs("option",{value:d.value,children:[d.label,"s"]},d.value))]})]})]}),e.jsx("div",{className:"spot-panel-content",children:p.length===0?e.jsxs("div",{className:"spot-empty-state",role:"status","aria-live":"polite",children:[e.jsx("div",{className:"icon","aria-hidden":"true",children:"+"}),e.jsx("h3",{children:"Aucune entite"}),e.jsx("p",{children:"Commencez par ajouter votre premiere entite"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-primary",onClick:l,children:"Nouvelle entite"})]}):e.jsx("ul",{ref:m,className:"spot-entity-list",role:"listbox","aria-labelledby":"entity-list-title","aria-activedescendant":c?`entity-${c}`:void 0,children:p.map((d,h)=>e.jsx(Ie,{entity:d,selected:d.id===c,onClick:()=>a(d),onKeyDown:S=>r(S,h)},d.id))})})]})}function Ie({entity:t,selected:c,onClick:a,onKeyDown:l}){const i=te[t.type]||"+",j=re.find(s=>s.value===t.type)?.label||t.type,b=ce.find(s=>s.value===t.role)?.label||t.role;return e.jsxs("li",{id:`entity-${t.id}`,className:`spot-entity-item ${c?"selected":""}`,onClick:a,onKeyDown:l,role:"option","aria-selected":c,tabIndex:0,children:[e.jsx("div",{className:"spot-entity-item-header",children:e.jsxs("div",{children:[e.jsx("div",{className:"spot-entity-name",children:t.name}),t.alias&&e.jsxs("div",{className:"spot-entity-alias",children:[t.alias.substring(0,40),t.alias.length>40?"...":""]})]})}),e.jsxs("div",{className:"spot-entity-meta",children:[e.jsxs("span",{className:`spot-entity-type-badge spot-type-${t.type}`,"aria-label":`Type: ${j}`,children:[e.jsx("span",{"aria-hidden":"true",children:i})," ",j]}),t.role&&e.jsx("span",{className:`spot-role-badge spot-role-${t.role}`,"aria-label":`Role: ${b}`,children:b})]})]})}const ge=[{id:"info",label:"Info"},{id:"relations",label:"Relations"},{id:"notes",label:"Notes"}];function De({entity:t,relations:c,notes:a,entities:l,onEdit:i,onAddRelation:j,onEditRelation:b,onDeleteRelation:s,onAddNote:m,onEditNote:p,onDeleteNote:r,onSelectEntity:d}){const[h,S]=n.useState("info"),R=n.useId(),P=n.useCallback((C,_)=>{const q=ge;let M=_;switch(C.key){case"ArrowRight":C.preventDefault(),M=(_+1)%q.length;break;case"ArrowLeft":C.preventDefault(),M=_===0?q.length-1:_-1;break;case"Home":C.preventDefault(),M=0;break;case"End":C.preventDefault(),M=q.length-1;break;default:return}S(q[M].id),document.getElementById(`tab-${q[M].id}`)?.focus()},[]);if(!t)return e.jsx("div",{className:"spot-panel spot-detail-panel",children:e.jsxs("div",{className:"spot-empty-state",role:"status",children:[e.jsx("div",{className:"icon","aria-hidden":"true",children:"+"}),e.jsx("h3",{children:"Aucune entite selectionnee"}),e.jsx("p",{children:"Selectionnez une entite dans la liste"})]})});const O=te[t.type]||"+",N=re.find(C=>C.value===t.type)?.label||t.type,f=ce.find(C=>C.value===t.role)?.label||t.role,E=C=>{const _=C.from_entity===t.id?C.to_entity:C.from_entity;return l.find(q=>q.id===_)},g=C=>C.from_entity===t.id?"outgoing":"incoming",k={info:"",relations:c.length,notes:a.length};return e.jsxs("div",{className:"spot-panel spot-detail-panel",children:[e.jsxs("header",{className:"spot-detail-header",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"spot-detail-title",children:[e.jsx("span",{"aria-hidden":"true",children:O})," ",t.name]}),t.alias&&e.jsx("p",{className:"spot-detail-subtitle",children:t.alias})]}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm",onClick:()=>i(t),children:"Modifier"})]}),e.jsxs("div",{className:"spot-detail-badges",children:[e.jsxs("span",{className:`spot-entity-type-badge spot-type-${t.type}`,"aria-label":`Type: ${N}`,children:[e.jsx("span",{"aria-hidden":"true",children:O})," ",N]}),t.role&&e.jsx("span",{className:`spot-role-badge spot-role-${t.role}`,style:{"--role-color":we[t.role]},"aria-label":`Role: ${f}`,children:f})]}),e.jsx("div",{className:"spot-detail-tabs",role:"tablist","aria-label":"Sections de detail",children:ge.map((C,_)=>e.jsxs("button",{id:`tab-${C.id}`,type:"button",role:"tab","aria-selected":h===C.id,"aria-controls":`${R}-${C.id}`,tabIndex:h===C.id?0:-1,className:`spot-detail-tab ${h===C.id?"active":""}`,onClick:()=>S(C.id),onKeyDown:q=>P(q,_),children:[C.label,k[C.id]!==""&&` (${k[C.id]})`]},C.id))}),e.jsxs("div",{className:"spot-detail-content",children:[e.jsx("div",{id:`${R}-info`,role:"tabpanel","aria-labelledby":"tab-info",hidden:h!=="info",children:h==="info"&&e.jsx(Ae,{entity:t})}),e.jsx("div",{id:`${R}-relations`,role:"tabpanel","aria-labelledby":"tab-relations",hidden:h!=="relations",children:h==="relations"&&e.jsx(Re,{relations:c,entity:t,getRelatedEntity:E,getRelationDirection:g,onAdd:j,onEdit:b,onDelete:s,onSelectEntity:d})}),e.jsx("div",{id:`${R}-notes`,role:"tabpanel","aria-labelledby":"tab-notes",hidden:h!=="notes",children:h==="notes"&&e.jsx(_e,{notes:a,onAdd:m,onEdit:p,onDelete:r})})]})]})}function Ae({entity:t}){return e.jsxs("div",{className:"spot-detail-body",children:[t.desc&&e.jsxs("section",{className:"spot-detail-section",children:[e.jsx("h2",{className:"spot-detail-section-title",children:"Description"}),e.jsx("p",{className:"spot-detail-desc",children:t.desc})]}),t.date&&e.jsxs("section",{className:"spot-detail-section",children:[e.jsx("h2",{className:"spot-detail-section-title",children:"Date"}),e.jsx("p",{className:"spot-detail-desc",children:t.date})]}),t.tags?.length>0&&e.jsxs("section",{className:"spot-detail-section",children:[e.jsx("h2",{className:"spot-detail-section-title",children:"Tags"}),e.jsx("div",{className:"spot-detail-tags",role:"list","aria-label":"Liste des tags",children:t.tags.map((c,a)=>e.jsx("span",{className:"spot-tag",role:"listitem",children:c},a))})]}),!t.desc&&!t.date&&(!t.tags||t.tags.length===0)&&e.jsx("div",{className:"spot-empty-state",role:"status",children:e.jsx("p",{children:"Aucune information supplementaire"})})]})}function Re({relations:t,entity:c,getRelatedEntity:a,getRelationDirection:l,onAdd:i,onEdit:j,onDelete:b,onSelectEntity:s}){return e.jsx("div",{className:"spot-detail-body",children:e.jsxs("div",{className:"spot-detail-section",children:[e.jsxs("div",{className:"spot-detail-section-title",children:[e.jsx("span",{children:"Relations"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm spot-btn-primary",onClick:()=>i(c),children:"Ajouter"})]}),t.length===0?e.jsx("div",{className:"spot-empty-state",role:"status",children:e.jsx("p",{children:"Aucune relation"})}):e.jsx("ul",{className:"spot-relation-list","aria-label":"Liste des relations",children:t.map(m=>{const p=a(m),r=l(m),d=te[p?.type]||"+",h=r==="outgoing"?"vers":"depuis";return e.jsxs("li",{className:"spot-relation-item",tabIndex:0,children:[e.jsx("div",{className:"spot-relation-icon","aria-hidden":"true",children:r==="outgoing"?">":"<"}),e.jsxs("div",{className:"spot-relation-info",children:[e.jsx("div",{className:"spot-relation-type",children:m.type}),e.jsxs("button",{type:"button",className:"spot-relation-name",onClick:()=>p&&s(p),"aria-label":`${h} ${p?.name||"Inconnu"}`,children:[e.jsx("span",{"aria-hidden":"true",children:d})," ",p?.name||"Inconnu"]})]}),e.jsxs("div",{className:"spot-relation-actions",children:[e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm spot-btn-ghost",onClick:()=>j(m),"aria-label":`Modifier la relation ${m.type}`,children:"Modifier"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm spot-btn-ghost spot-btn-danger",onClick:()=>b(m.id),"aria-label":`Supprimer la relation ${m.type}`,children:"Supprimer"})]})]},m.id)})})]})})}function _e({notes:t,onAdd:c,onEdit:a,onDelete:l}){return e.jsx("div",{className:"spot-detail-body",children:e.jsxs("div",{className:"spot-detail-section",children:[e.jsxs("div",{className:"spot-detail-section-title",children:[e.jsx("span",{children:"Notes"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm spot-btn-primary",onClick:c,children:"Ajouter"})]}),t.length===0?e.jsx("div",{className:"spot-empty-state",role:"status",children:e.jsx("p",{children:"Aucune note"})}):e.jsx("ul",{className:"spot-note-list","aria-label":"Liste des notes",children:t.map(i=>e.jsxs("li",{className:"spot-note-item",tabIndex:0,children:[e.jsx("div",{className:"spot-note-content",children:i.content}),i.source&&e.jsxs("div",{className:"spot-note-date",children:["Source: ",i.source]}),e.jsxs("div",{className:"spot-relation-actions",children:[e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm spot-btn-ghost",onClick:()=>a(i),"aria-label":"Modifier la note",children:"Modifier"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm spot-btn-ghost spot-btn-danger",onClick:()=>l(i.id),"aria-label":"Supprimer la note",children:"Supprimer"})]})]},i.id))})]})})}function me({isOpen:t,onClose:c,title:a,children:l,footer:i,large:j=!1}){const b=n.useRef(null),s=n.useRef(null),m=n.useId(),p=n.useId(),r=n.useCallback(S=>{S.key==="Escape"&&c()},[c]),d=n.useCallback(S=>{if(!b.current||S.key!=="Tab")return;const R=b.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),P=R[0],O=R[R.length-1];S.shiftKey&&document.activeElement===P?(S.preventDefault(),O?.focus()):!S.shiftKey&&document.activeElement===O&&(S.preventDefault(),P?.focus())},[]);n.useEffect(()=>(t&&(s.current=document.activeElement,document.addEventListener("keydown",r),document.addEventListener("keydown",d),document.body.style.overflow="hidden",requestAnimationFrame(()=>{b.current?.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])')?.focus()})),()=>{document.removeEventListener("keydown",r),document.removeEventListener("keydown",d),document.body.style.overflow="",!t&&s.current&&s.current.focus()}),[t,r,d]);const h=S=>{S.target===S.currentTarget&&c()};return t?e.jsx("div",{className:"spot-modal-overlay open",onClick:h,role:"dialog","aria-modal":"true","aria-labelledby":m,"aria-describedby":p,children:e.jsxs("div",{ref:b,className:`spot-modal ${j?"spot-modal-lg":""}`,role:"document",children:[e.jsxs("div",{className:"spot-modal-header",children:[e.jsx("h2",{className:"spot-modal-title",id:m,children:a}),e.jsx("button",{type:"button",className:"spot-modal-close",onClick:c,"aria-label":"Fermer la fenetre",children:e.jsx("span",{"aria-hidden":"true",children:"x"})})]}),e.jsx("div",{className:"spot-modal-body",id:p,children:l}),i&&e.jsx("div",{className:"spot-modal-footer",children:i})]})}):null}function Fe({isOpen:t,onClose:c,entity:a,onSave:l,onDelete:i}){const j=n.useId(),[b,s]=n.useState({name:"",type:"person",alias:"",desc:"",date:"",role:"",tags:""});n.useEffect(()=>{s(a?{name:a.name||"",type:a.type||"person",alias:a.alias||"",desc:a.desc||"",date:a.date||"",role:a.role||"",tags:a.tags?.join(", ")||""}:{name:"",type:"person",alias:"",desc:"",date:"",role:"",tags:""})},[a,t]);const m=async r=>{if(r.preventDefault(),!b.name.trim())return;const d={...b,tags:b.tags.split(",").map(h=>h.trim()).filter(Boolean)};await l(d,a?.id),c()},p=async()=>{a&&window.confirm("Supprimer cette entite et toutes ses relations ?")&&(await i(a.id),c())};return e.jsx(me,{isOpen:t,onClose:c,title:a?"Modifier l'entite":"Nouvelle entite",large:!0,footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"spot-btn",onClick:c,children:"Annuler"}),a&&e.jsx("button",{type:"button",className:"spot-btn spot-btn-danger",onClick:p,children:"Supprimer"}),e.jsx("button",{type:"submit",form:"entity-form",className:"spot-btn spot-btn-primary",children:"Enregistrer"})]}),children:e.jsxs("form",{id:"entity-form",onSubmit:m,children:[e.jsxs("div",{className:"spot-form-row",children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"entity-name",children:"Nom *"}),e.jsx("input",{type:"text",id:"entity-name",className:"spot-form-input",value:b.name,onChange:r=>s({...b,name:r.target.value}),placeholder:"Nom de l'entite",required:!0,"aria-required":"true",autoFocus:!0})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"entity-type",children:"Type *"}),e.jsx("select",{id:"entity-type",className:"spot-form-select",value:b.type,onChange:r=>s({...b,type:r.target.value}),children:re.map(r=>e.jsxs("option",{value:r.value,children:[r.icon," ",r.label]},r.value))})]})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"entity-alias",children:"Alias / Surnoms"}),e.jsx("input",{type:"text",id:"entity-alias",className:"spot-form-input",value:b.alias,onChange:r=>s({...b,alias:r.target.value}),placeholder:"Autres noms, separes par des virgules"})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"entity-desc",children:"Description"}),e.jsx("textarea",{id:"entity-desc",className:"spot-form-textarea",value:b.desc,onChange:r=>s({...b,desc:r.target.value}),placeholder:"Description detaillee..."})]}),e.jsxs("div",{className:"spot-form-row",children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"entity-date",children:"Date"}),e.jsx("input",{type:"text",id:"entity-date",className:"spot-form-input",value:b.date,onChange:r=>s({...b,date:r.target.value}),placeholder:"Date, periode, annee..."})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"entity-role",children:"Role (Plaidoyer)"}),e.jsx("select",{id:"entity-role",className:"spot-form-select",value:b.role,onChange:r=>s({...b,role:r.target.value}),children:ce.map(r=>e.jsxs("option",{value:r.value,children:[r.icon?`${r.icon} `:"",r.label]},r.value))})]})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"entity-tags",children:"Tags"}),e.jsx("input",{type:"text",id:"entity-tags",className:"spot-form-input",value:b.tags,onChange:r=>s({...b,tags:r.target.value}),placeholder:"Tags separes par des virgules","aria-describedby":j}),e.jsx("div",{id:j,className:"spot-form-hint",children:"Ex: important, quete, histoire"})]})]})})}const Ne=["connait","travaille avec","membre de","dirige","finance","oppose","soutient","influence","lie a","partenaire"];function Te({isOpen:t,onClose:c,relation:a,entities:l,fromEntity:i,onSave:j,onDelete:b}){const[s,m]=n.useState({from:"",to:"",type:"connait"});n.useEffect(()=>{m(a?{from:a.from_entity||"",to:a.to_entity||"",type:a.type||"connait"}:i?{from:i.id,to:"",type:"connait"}:{from:"",to:"",type:"connait"})},[a,i,t]);const p=async h=>{h.preventDefault(),!(!s.from||!s.to||s.from===s.to)&&(await j(s,a?.id),c())},r=async()=>{a&&window.confirm("Supprimer cette relation ?")&&(await b(a.id),c())},d=l.filter(h=>h.id!==s.from);return e.jsx(me,{isOpen:t,onClose:c,title:a?"Modifier la relation":"Nouvelle relation",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"spot-btn",onClick:c,children:"Annuler"}),a&&e.jsx("button",{type:"button",className:"spot-btn spot-btn-danger",onClick:r,children:"Supprimer"}),e.jsx("button",{type:"submit",form:"relation-form",className:"spot-btn spot-btn-primary",disabled:!s.from||!s.to||s.from===s.to,children:"Enregistrer"})]}),children:e.jsxs("form",{id:"relation-form",onSubmit:p,children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"relation-from",children:"De *"}),e.jsxs("select",{id:"relation-from",className:"spot-form-select",value:s.from,onChange:h=>m({...s,from:h.target.value}),required:!0,"aria-required":"true",children:[e.jsx("option",{value:"",children:"Selectionner une entite"}),l.map(h=>e.jsxs("option",{value:h.id,children:[te[h.type]," ",h.name]},h.id))]})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"relation-type",children:"Type de relation"}),e.jsx("select",{id:"relation-type",className:"spot-form-select",value:s.type,onChange:h=>m({...s,type:h.target.value}),children:Ne.map(h=>e.jsx("option",{value:h,children:h},h))}),e.jsx("input",{type:"text",id:"relation-custom-type",className:"spot-form-input",style:{marginTop:8},placeholder:"Ou saisir un type personnalise...",value:Ne.includes(s.type)?"":s.type,onChange:h=>m({...s,type:h.target.value||"connait"}),"aria-label":"Type de relation personnalise"})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"relation-to",children:"Vers *"}),e.jsxs("select",{id:"relation-to",className:"spot-form-select",value:s.to,onChange:h=>m({...s,to:h.target.value}),required:!0,"aria-required":"true",children:[e.jsx("option",{value:"",children:"Selectionner une entite"}),d.map(h=>e.jsxs("option",{value:h.id,children:[te[h.type]," ",h.name]},h.id))]})]}),s.from&&s.to&&e.jsxs("div",{className:"spot-relation-preview",role:"status","aria-live":"polite",children:[e.jsx("span",{children:l.find(h=>h.id===s.from)?.name}),e.jsx("span",{className:"spot-relation-preview-arrow","aria-hidden":"true",children:"-"}),e.jsx("span",{children:s.type}),e.jsx("span",{className:"spot-relation-preview-arrow","aria-hidden":"true",children:"-"}),e.jsx("span",{children:l.find(h=>h.id===s.to)?.name})]})]})})}function Oe({isOpen:t,onClose:c,note:a,entityId:l,onSave:i,onDelete:j}){const b=n.useId(),[s,m]=n.useState({content:"",source:""});n.useEffect(()=>{m(a?{content:a.content||"",source:a.source||""}:{content:"",source:""})},[a,t]);const p=async d=>{d.preventDefault(),s.content.trim()&&(await i({entityId:l,content:s.content,source:s.source},a?.id),c())},r=async()=>{a&&window.confirm("Supprimer cette note ?")&&(await j(a.id),c())};return e.jsx(me,{isOpen:t,onClose:c,title:a?"Modifier la note":"Nouvelle note",footer:e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"spot-btn",onClick:c,children:"Annuler"}),a&&e.jsx("button",{type:"button",className:"spot-btn spot-btn-danger",onClick:r,children:"Supprimer"}),e.jsx("button",{type:"submit",form:"note-form",className:"spot-btn spot-btn-primary",disabled:!s.content.trim(),children:"Enregistrer"})]}),children:e.jsxs("form",{id:"note-form",onSubmit:p,children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"note-content",children:"Note *"}),e.jsx("textarea",{id:"note-content",className:"spot-form-textarea",value:s.content,onChange:d=>m({...s,content:d.target.value}),placeholder:"Contenu de la note...",rows:6,required:!0,"aria-required":"true",autoFocus:!0})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"note-source",children:"Source"}),e.jsx("input",{type:"text",id:"note-source",className:"spot-form-input",value:s.source,onChange:d=>m({...s,source:d.target.value}),placeholder:"Origine de l'information...","aria-describedby":b}),e.jsx("div",{id:b,className:"spot-form-hint",children:"Ex: temoignage, document, observation"})]})]})})}function Me({entities:t,relations:c,selectedId:a,onSelectEntity:l,onAddEntity:i}){const j=n.useRef(null),b=n.useRef(null),s=n.useRef(null),m=n.useRef([]),[p,r]=n.useState({width:800,height:600}),[d,h]=n.useState(!1),[S,R]=n.useState(null),[P,O]=n.useState(!1),[N,f]=n.useState({x:0,y:0}),[E,g]=n.useState({x:0,y:0}),[k,C]=n.useState(1),[_,q]=n.useState(-1),M=n.useRef(null),U=n.useId();n.useEffect(()=>{const o=()=>{if(b.current){const x=b.current.getBoundingClientRect();r({width:x.width,height:x.height})}};return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]),n.useEffect(()=>{const o=new Set(m.current.map(v=>v.id)),x=t.filter(v=>!o.has(v.id)).map(v=>({id:v.id,x:Math.random()*(p.width-100)+50,y:Math.random()*(p.height-100)+50,vx:0,vy:0}));m.current=[...m.current.filter(v=>t.some(I=>I.id===v.id)),...x]},[t,p]);const Y=n.useCallback(o=>{const x=c.filter(v=>v.from_entity===o.id||v.to_entity===o.id).length;return Math.min(30,15+x*2)},[c]),G=n.useCallback((o,x)=>{const v=(o-N.x)/k,I=(x-N.y)/k;for(let z=m.current.length-1;z>=0;z--){const V=m.current[z],L=t.find($=>$.id===V.id);if(!L)continue;const B=Y(L),W=V.x-v,A=V.y-I;if(W*W+A*A<B*B)return V}return null},[t,Y,N,k]),Z=n.useCallback(o=>{const x=j.current.getBoundingClientRect(),v=o.clientX-x.left,I=o.clientY-x.top,z=G(v,I);if(z){R(z),h(!0);const V=t.find(L=>L.id===z.id);V&&l(V)}else O(!0),g({x:o.clientX,y:o.clientY})},[G,t,l]),Q=n.useCallback(o=>{if(d&&S){const x=j.current.getBoundingClientRect(),v=(o.clientX-x.left-N.x)/k,I=(o.clientY-x.top-N.y)/k;S.x=v,S.y=I,S.vx=0,S.vy=0}else if(P){const x=o.clientX-E.x,v=o.clientY-E.y;f(I=>({x:I.x+x,y:I.y+v})),g({x:o.clientX,y:o.clientY})}},[d,S,P,E,N,k]),u=n.useCallback(()=>{h(!1),R(null),O(!1)},[]),y=n.useCallback(o=>{o.preventDefault();const x=o.deltaY>0?.9:1.1;C(v=>Math.max(.3,Math.min(3,v*x)))},[]),w=n.useCallback(o=>{if(o.touches.length===2){const x=o.touches[0].clientX-o.touches[1].clientX,v=o.touches[0].clientY-o.touches[1].clientY;M.current=Math.sqrt(x*x+v*v)}else if(o.touches.length===1){const x=o.touches[0];Z({clientX:x.clientX,clientY:x.clientY})}},[Z]),D=n.useCallback(o=>{if(o.touches.length===2&&M.current!==null){o.preventDefault();const x=o.touches[0].clientX-o.touches[1].clientX,v=o.touches[0].clientY-o.touches[1].clientY,I=Math.sqrt(x*x+v*v),z=I/M.current;C(V=>Math.max(.3,Math.min(3,V*z))),M.current=I}else if(o.touches.length===1){const x=o.touches[0];Q({clientX:x.clientX,clientY:x.clientY})}},[Q]),F=n.useCallback(()=>{M.current=null,u()},[u]),J=n.useCallback(o=>{switch(o.key){case"ArrowUp":o.preventDefault(),f(I=>({...I,y:I.y+50}));break;case"ArrowDown":o.preventDefault(),f(I=>({...I,y:I.y-50}));break;case"ArrowLeft":o.preventDefault(),f(I=>({...I,x:I.x+50}));break;case"ArrowRight":o.preventDefault(),f(I=>({...I,x:I.x-50}));break;case"+":case"=":o.preventDefault(),C(I=>Math.min(3,I+.2));break;case"-":o.preventDefault(),C(I=>Math.max(.3,I-.2));break;case"0":o.preventDefault(),f({x:0,y:0}),C(1);break;case"Tab":if(t.length>0){o.preventDefault();const I=o.shiftKey?_<=0?t.length-1:_-1:_>=t.length-1?0:_+1;q(I),l(t[I])}break;case"Enter":case" ":_>=0&&_<t.length&&(o.preventDefault(),l(t[_]));break}},[t,_,l]);n.useEffect(()=>{const o=j.current;if(!o)return;const x=o.getContext("2d"),v=m.current,I=()=>{for(let A=0;A<v.length;A++)for(let $=A+1;$<v.length;$++){const X=v[$].x-v[A].x,K=v[$].y-v[A].y,H=Math.sqrt(X*X+K*K)||1,ae=5e3/(H*H),ne=X/H*ae,le=K/H*ae;v[A].vx-=ne,v[A].vy-=le,v[$].vx+=ne,v[$].vy+=le}c.forEach(A=>{const $=v.find(K=>K.id===A.from_entity),X=v.find(K=>K.id===A.to_entity);if($&&X){const K=X.x-$.x,H=X.y-$.y,ae=Math.sqrt(K*K+H*H)||1,ne=(ae-150)*.01,le=K/ae*ne,he=H/ae*ne;$.vx+=le,$.vy+=he,X.vx-=le,X.vy-=he}}),v.forEach(A=>{S&&A.id===S.id||(A.vx*=.9,A.vy*=.9,A.x+=A.vx,A.y+=A.vy,A.x=Math.max(30,Math.min(p.width/k-30,A.x)),A.y=Math.max(30,Math.min(p.height/k-30,A.y)))})},z=()=>{x.clearRect(0,0,o.width,o.height),x.save(),x.translate(N.x,N.y),x.scale(k,k),c.forEach(L=>{const B=v.find(A=>A.id===L.from_entity),W=v.find(A=>A.id===L.to_entity);if(B&&W){x.beginPath(),x.moveTo(B.x,B.y),x.lineTo(W.x,W.y),x.strokeStyle="rgba(100, 116, 139, 0.4)",x.lineWidth=1.5,x.stroke();const A=(B.x+W.x)/2,$=(B.y+W.y)/2;x.fillStyle="rgba(148, 163, 184, 0.8)",x.font="10px system-ui",x.textAlign="center",x.fillText(L.type,A,$-5)}}),t.forEach(L=>{const B=v.find(X=>X.id===L.id);if(!B)return;const W=Y(L),A=L.id===a,$=L.role?we[L.role]:Se[L.type]||"#6b7894";x.beginPath(),x.arc(B.x,B.y,W,0,Math.PI*2),x.fillStyle=$,x.fill(),A&&(x.strokeStyle="#fff",x.lineWidth=3,x.stroke()),x.fillStyle="#fff",x.font=`${Math.max(10,W*.6)}px system-ui`,x.textAlign="center",x.textBaseline="middle",x.fillText(L.name.substring(0,8),B.x,B.y)}),x.restore()},V=()=>{I(),z(),s.current=requestAnimationFrame(V)};return V(),()=>{s.current&&cancelAnimationFrame(s.current)}},[t,c,a,p,Y,S,N,k]);const de=()=>{f({x:0,y:0}),C(1)},se=t.find(o=>o.id===a),oe=t.length===0?"Graphe vide. Ajoutez des entites pour les visualiser.":`Graphe de relations avec ${t.length} entites et ${c.length} relations. ${se?`Entite selectionnee: ${se.name}.`:""} Utilisez les fleches pour naviguer, +/- pour zoomer, 0 pour reinitialiser, Tab pour parcourir les entites.`;return e.jsxs("div",{ref:b,className:"spot-graph-container",role:"application","aria-label":"Graphe de relations","aria-describedby":U,tabIndex:0,onKeyDown:J,children:[e.jsx("div",{id:U,className:"spot-sr-only",children:oe}),e.jsx("canvas",{ref:j,width:p.width,height:p.height,className:"spot-graph-canvas","aria-hidden":"true",onMouseDown:Z,onMouseMove:Q,onMouseUp:u,onMouseLeave:u,onWheel:y,onTouchStart:w,onTouchMove:D,onTouchEnd:F}),e.jsxs("div",{className:"spot-graph-controls",role:"toolbar","aria-label":"Controles du graphe",children:[e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm",onClick:()=>C(o=>Math.min(3,o*1.2)),"aria-label":"Zoom avant",children:"+"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm",onClick:()=>C(o=>Math.max(.3,o*.8)),"aria-label":"Zoom arriere",children:"-"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm",onClick:de,"aria-label":"Reinitialiser la vue",children:"Reset"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm spot-btn-primary",onClick:i,"aria-label":"Ajouter une entite",children:"+ Entite"})]}),e.jsx("div",{className:"spot-graph-status spot-sr-only","aria-live":"polite",children:se&&`Entite selectionnee: ${se.name}`}),t.length===0&&e.jsxs("div",{className:"spot-graph-empty",role:"status",children:[e.jsx("p",{children:"Aucune entite a afficher"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-primary",onClick:i,children:"Creer une entite"})]})]})}function Pe({data:t,onUpdate:c}){return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Theorie du Changement"}),e.jsx("p",{className:"spot-section-desc",children:"Definissez votre vision, vos valeurs et vos hypotheses de changement."}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"toc-vision",children:"Vision"}),e.jsx("textarea",{id:"toc-vision",className:"spot-form-textarea",value:t?.vision||"",onChange:a=>c("vision",a.target.value),placeholder:"Quel monde voulez-vous creer ?",rows:3})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"toc-values",children:"Valeurs"}),e.jsx("textarea",{id:"toc-values",className:"spot-form-textarea",value:t?.values||"",onChange:a=>c("values",a.target.value),placeholder:"Quelles sont vos valeurs fondamentales ?",rows:3})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"toc-hypotheses",children:"Hypotheses"}),e.jsx("textarea",{id:"toc-hypotheses",className:"spot-form-textarea",value:t?.hypotheses||"",onChange:a=>c("hypotheses",a.target.value),placeholder:"Si nous faisons X, alors Y se produira parce que Z...",rows:4})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"toc-missions",children:"Missions"}),e.jsx("textarea",{id:"toc-missions",className:"spot-form-textarea",value:t?.missions||"",onChange:a=>c("missions",a.target.value),placeholder:"Quelles sont vos missions principales ?",rows:3})]})]})}function qe({data:t,onUpdate:c}){const[a,l]=n.useState({strengths:"",weaknesses:"",opportunities:"",threats:""}),i=s=>{if(!a[s].trim())return;const m=t?.[s]||[];c(s,[...m,a[s].trim()]),l(p=>({...p,[s]:""}))},j=(s,m)=>{const p=t?.[s]||[];c(s,p.filter((r,d)=>d!==m))},b=[{key:"strengths",label:"Forces",color:"#4ade80",placeholder:"Ajouter une force..."},{key:"weaknesses",label:"Faiblesses",color:"#f87171",placeholder:"Ajouter une faiblesse..."},{key:"opportunities",label:"Opportunites",color:"#4da6ff",placeholder:"Ajouter une opportunite..."},{key:"threats",label:"Menaces",color:"#fbbf24",placeholder:"Ajouter une menace..."}];return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Analyse SWOT"}),e.jsx("p",{className:"spot-section-desc",children:"Analysez vos forces, faiblesses, opportunites et menaces."}),e.jsx("div",{className:"spot-swot-grid",children:b.map(s=>e.jsxs("div",{className:"spot-swot-quadrant",style:{"--quadrant-color":s.color},children:[e.jsx("h4",{className:"spot-swot-label",children:s.label}),e.jsx("div",{className:"spot-swot-items",children:(t?.[s.key]||[]).map((m,p)=>e.jsxs("div",{className:"spot-swot-item",children:[e.jsx("span",{children:m}),e.jsx("button",{className:"spot-btn-icon spot-btn-danger",onClick:()=>j(s.key,p),"aria-label":"Supprimer",children:"x"})]},p))}),e.jsxs("div",{className:"spot-swot-add",children:[e.jsx("input",{type:"text",className:"spot-form-input",value:a[s.key],onChange:m=>l(p=>({...p,[s.key]:m.target.value})),placeholder:s.placeholder,onKeyDown:m=>m.key==="Enter"&&i(s.key)}),e.jsx("button",{className:"spot-btn spot-btn-sm",onClick:()=>i(s.key),children:"+"})]})]},s.key))})]})}function $e({data:t,onUpdate:c}){const a=[{key:"political",label:"Politique",icon:"ðŸ›ï¸",placeholder:"Facteurs politiques..."},{key:"economic",label:"Economique",icon:"ðŸ’°",placeholder:"Facteurs economiques..."},{key:"social",label:"Social",icon:"ðŸ‘¥",placeholder:"Facteurs sociaux..."},{key:"tech",label:"Technologique",icon:"ðŸ’»",placeholder:"Facteurs technologiques..."},{key:"env",label:"Environnemental",icon:"ðŸŒ±",placeholder:"Facteurs environnementaux..."},{key:"legal",label:"Legal",icon:"âš–ï¸",placeholder:"Facteurs juridiques..."}];return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Analyse PESTEL"}),e.jsx("p",{className:"spot-section-desc",children:"Analysez les facteurs externes qui influencent votre contexte."}),e.jsx("div",{className:"spot-pestel-grid",children:a.map(l=>e.jsxs("div",{className:"spot-pestel-factor",children:[e.jsxs("label",{className:"spot-form-label",htmlFor:`pestel-${l.key}`,children:[l.icon," ",l.label]}),e.jsx("textarea",{id:`pestel-${l.key}`,className:"spot-form-textarea",value:t?.[l.key]||"",onChange:i=>c(l.key,i.target.value),placeholder:l.placeholder,rows:3})]},l.key))})]})}function Le({data:t,onUpdate:c}){const[a,l]=n.useState(""),[i,j]=n.useState(""),b=()=>{if(!a.trim())return;const r=t?.causes||[];c("causes",[...r,a.trim()]),l("")},s=r=>{const d=t?.causes||[];c("causes",d.filter((h,S)=>S!==r))},m=()=>{if(!i.trim())return;const r=t?.consequences||[];c("consequences",[...r,i.trim()]),j("")},p=r=>{const d=t?.consequences||[];c("consequences",d.filter((h,S)=>S!==r))};return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Arbre a Problemes"}),e.jsx("p",{className:"spot-section-desc",children:"Identifiez le probleme central, ses causes profondes et ses consequences."}),e.jsxs("div",{className:"spot-tree",children:[e.jsxs("div",{className:"spot-tree-section spot-tree-consequences",children:[e.jsx("h4",{className:"spot-tree-label",children:"Consequences"}),e.jsx("div",{className:"spot-tree-items",children:(t?.consequences||[]).map((r,d)=>e.jsxs("div",{className:"spot-tree-item",children:[e.jsx("span",{children:r}),e.jsx("button",{className:"spot-btn-icon spot-btn-danger",onClick:()=>p(d),"aria-label":"Supprimer",children:"x"})]},d))}),e.jsxs("div",{className:"spot-tree-add",children:[e.jsx("input",{type:"text",className:"spot-form-input",value:i,onChange:r=>j(r.target.value),placeholder:"Ajouter une consequence...",onKeyDown:r=>r.key==="Enter"&&m()}),e.jsx("button",{className:"spot-btn spot-btn-sm",onClick:m,children:"+"})]})]}),e.jsx("div",{className:"spot-tree-trunk",children:e.jsxs("div",{className:"spot-tree-problem",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"tree-problem",children:"Probleme Central"}),e.jsx("textarea",{id:"tree-problem",className:"spot-form-textarea",value:t?.problem||"",onChange:r=>c("problem",r.target.value),placeholder:"Quel est le probleme principal que vous cherchez a resoudre ?",rows:3})]})}),e.jsxs("div",{className:"spot-tree-section spot-tree-causes",children:[e.jsx("h4",{className:"spot-tree-label",children:"Causes"}),e.jsx("div",{className:"spot-tree-items",children:(t?.causes||[]).map((r,d)=>e.jsxs("div",{className:"spot-tree-item",children:[e.jsx("span",{children:r}),e.jsx("button",{className:"spot-btn-icon spot-btn-danger",onClick:()=>s(d),"aria-label":"Supprimer",children:"x"})]},d))}),e.jsxs("div",{className:"spot-tree-add",children:[e.jsx("input",{type:"text",className:"spot-form-input",value:a,onChange:r=>l(r.target.value),placeholder:"Ajouter une cause...",onKeyDown:r=>r.key==="Enter"&&b()}),e.jsx("button",{className:"spot-btn spot-btn-sm",onClick:b,children:"+"})]})]})]})]})}function ze({data:t,onSave:c}){const a=t||["","","","","",""],l=(i,j)=>{const b=[...a];b[i]=j,c(b)};return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Les 5 Pourquoi"}),e.jsx("p",{className:"spot-section-desc",children:`Posez 5 fois la question "Pourquoi ?" pour identifier la cause racine d'un probleme.`}),e.jsxs("div",{className:"spot-five-why",children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"why-0",children:"Probleme initial"}),e.jsx("input",{type:"text",id:"why-0",className:"spot-form-input",value:a[0],onChange:i=>l(0,i.target.value),placeholder:"Quel est le probleme observe ?"})]}),[1,2,3,4,5].map(i=>e.jsxs("div",{className:"spot-why-item",children:[e.jsx("div",{className:"spot-why-number",children:i}),e.jsxs("div",{className:"spot-form-group",children:[e.jsxs("label",{className:"spot-form-label",htmlFor:`why-${i}`,children:["Pourquoi ",i===1?"ce probleme existe-t-il":"cela"," ?"]}),e.jsx("input",{type:"text",id:`why-${i}`,className:"spot-form-input",value:a[i]||"",onChange:j=>l(i,j.target.value),placeholder:i===5?"Cause racine identifiee":`Reponse ${i}...`})]})]},i))]})]})}function Be({data:t,onSave:c}){const[a,l]=n.useState({text:"",level:"general"}),i=t||[],j=()=>{a.text.trim()&&(c([...i,{id:Date.now(),...a}]),l({text:"",level:"general"}))},b=m=>{c(i.filter(p=>p.id!==m))},s=[{value:"general",label:"Objectif General",color:"#4da6ff"},{value:"specific",label:"Objectif Specifique",color:"#4ade80"},{value:"result",label:"Resultat Attendu",color:"#fbbf24"}];return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Objectifs"}),e.jsx("p",{className:"spot-section-desc",children:"Definissez vos objectifs generaux, specifiques et resultats attendus."}),e.jsx("div",{className:"spot-objectives",children:s.map(m=>e.jsxs("div",{className:"spot-objectives-group",children:[e.jsxs("h4",{className:"spot-objectives-label",style:{color:m.color},children:[m.label,"s"]}),e.jsx("div",{className:"spot-objectives-list",children:i.filter(p=>p.level===m.value).map(p=>e.jsxs("div",{className:"spot-objective-item",children:[e.jsx("span",{children:p.text}),e.jsx("button",{className:"spot-btn-icon spot-btn-danger",onClick:()=>b(p.id),"aria-label":"Supprimer",children:"x"})]},p.id))})]},m.value))}),e.jsx("div",{className:"spot-add-form",children:e.jsxs("div",{className:"spot-form-row",children:[e.jsx("div",{className:"spot-form-group",style:{flex:2},children:e.jsx("input",{type:"text",className:"spot-form-input",value:a.text,onChange:m=>l(p=>({...p,text:m.target.value})),placeholder:"Nouvel objectif...",onKeyDown:m=>m.key==="Enter"&&j()})}),e.jsx("div",{className:"spot-form-group",children:e.jsx("select",{className:"spot-form-select",value:a.level,onChange:m=>l(p=>({...p,level:m.target.value})),children:s.map(m=>e.jsx("option",{value:m.value,children:m.label},m.value))})}),e.jsx("button",{className:"spot-btn spot-btn-primary",onClick:j,children:"Ajouter"})]})})]})}function Ye({data:t,onSave:c}){const a=t||[],l=i=>{a.includes(i)?c(a.filter(j=>j!==i)):c([...a,i])};return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Strategies"}),e.jsx("p",{className:"spot-section-desc",children:"Selectionnez les strategies que vous souhaitez utiliser pour atteindre vos objectifs."}),e.jsx("div",{className:"spot-strategies-grid",children:be.map(i=>{const j=a.includes(i.id);return e.jsxs("button",{className:`spot-strategy-card ${j?"selected":""}`,onClick:()=>l(i.id),type:"button",children:[e.jsx("span",{className:"spot-strategy-emoji",children:i.emoji}),e.jsx("span",{className:"spot-strategy-name",children:i.name}),e.jsx("span",{className:"spot-strategy-desc",children:i.desc}),j&&e.jsx("span",{className:"spot-strategy-check",children:"Selected"})]},i.id)})}),a.length>0&&e.jsxs("div",{className:"spot-selected-strategies",children:[e.jsxs("h4",{children:["Strategies selectionnees (",a.length,")"]}),e.jsx("div",{className:"spot-selected-list",children:a.map(i=>{const j=be.find(b=>b.id===i);return j?e.jsxs("span",{className:"spot-selected-tag",children:[j.emoji," ",j.name]},i):null})})]})]})}function Je({data:t,onSave:c}){const[a,l]=n.useState({target:"",message:"",tone:"informative"}),[i,j]=n.useState(null),b=t||[],s=()=>{a.message.trim()&&(i?(c(b.map(d=>d.id===i?{...d,...a}:d)),j(null)):c([...b,{id:Date.now(),...a}]),l({target:"",message:"",tone:"informative"}))},m=d=>{l({target:d.target,message:d.message,tone:d.tone}),j(d.id)},p=d=>{c(b.filter(h=>h.id!==d))},r=[{value:"informative",label:"Informatif"},{value:"persuasive",label:"Persuasif"},{value:"emotional",label:"Emotionnel"},{value:"urgent",label:"Urgent"},{value:"inspiring",label:"Inspirant"}];return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Messages Cles"}),e.jsx("p",{className:"spot-section-desc",children:"Definissez les messages adaptes a chaque public cible."}),e.jsx("div",{className:"spot-messages-list",children:b.map(d=>e.jsxs("div",{className:"spot-message-card",children:[e.jsxs("div",{className:"spot-message-header",children:[e.jsx("span",{className:"spot-message-target",children:d.target||"Tous publics"}),e.jsx("span",{className:"spot-message-tone",children:d.tone})]}),e.jsx("p",{className:"spot-message-text",children:d.message}),e.jsxs("div",{className:"spot-message-actions",children:[e.jsx("button",{className:"spot-btn-icon",onClick:()=>m(d),"aria-label":"Modifier",children:"Edit"}),e.jsx("button",{className:"spot-btn-icon spot-btn-danger",onClick:()=>p(d.id),"aria-label":"Supprimer",children:"x"})]})]},d.id))}),e.jsxs("div",{className:"spot-add-form",children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"msg-target",children:"Public cible"}),e.jsx("input",{type:"text",id:"msg-target",className:"spot-form-input",value:a.target,onChange:d=>l(h=>({...h,target:d.target.value})),placeholder:"Ex: decideurs, grand public, medias..."})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"msg-message",children:"Message"}),e.jsx("textarea",{id:"msg-message",className:"spot-form-textarea",value:a.message,onChange:d=>l(h=>({...h,message:d.target.value})),placeholder:"Votre message cle...",rows:3})]}),e.jsxs("div",{className:"spot-form-row",children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"msg-tone",children:"Ton"}),e.jsx("select",{id:"msg-tone",className:"spot-form-select",value:a.tone,onChange:d=>l(h=>({...h,tone:d.target.value})),children:r.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value))})]}),e.jsx("button",{className:"spot-btn spot-btn-primary",onClick:s,children:i?"Modifier":"Ajouter"})]})]})]})}function Ve({data:t,entities:c,onSave:a}){const[l,i]=n.useState({entityId:"",position:0,influence:3,access:"none",notes:""}),j=t||[],b=()=>{if(!l.entityId)return;const p=j.find(r=>r.entityId===l.entityId);a(p?j.map(r=>r.entityId===l.entityId?{...r,...l}:r):[...j,{id:Date.now(),...l}]),i({entityId:"",position:0,influence:3,access:"none",notes:""})},s=p=>{a(j.filter(r=>r.id!==p))},m=p=>c.find(r=>r.id===p);return e.jsxs("div",{className:"spot-section",children:[e.jsx("h3",{className:"spot-section-title",children:"Cibles de Plaidoyer"}),e.jsx("p",{className:"spot-section-desc",children:"Evaluez la position, l'influence et l'acces aux acteurs cles."}),j.length>0&&e.jsx("div",{className:"spot-targets-matrix",children:e.jsxs("table",{className:"spot-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Acteur"}),e.jsx("th",{children:"Position"}),e.jsx("th",{children:"Influence"}),e.jsx("th",{children:"Acces"}),e.jsx("th",{children:"Notes"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:j.map(p=>{const r=m(p.entityId);return e.jsxs("tr",{children:[e.jsx("td",{children:r?e.jsxs("span",{children:[te[r.type]," ",r.name]}):e.jsx("span",{className:"spot-text-muted",children:"Inconnu"})}),e.jsx("td",{children:e.jsxs("span",{className:`spot-position spot-position-${p.position}`,children:[je[p.position]," ",fe[p.position]]})}),e.jsx("td",{children:e.jsx("div",{className:"spot-influence-bar",children:[1,2,3,4,5].map(d=>e.jsx("span",{className:`spot-influence-dot ${d<=p.influence?"filled":""}`},d))})}),e.jsx("td",{children:ve.find(d=>d.value===p.access)?.label}),e.jsx("td",{className:"spot-text-small",children:p.notes}),e.jsx("td",{children:e.jsx("button",{className:"spot-btn-icon spot-btn-danger",onClick:()=>s(p.id),"aria-label":"Supprimer",children:"x"})})]},p.id)})})]})}),e.jsxs("div",{className:"spot-add-form",children:[e.jsxs("div",{className:"spot-form-row",children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"target-entity",children:"Acteur"}),e.jsxs("select",{id:"target-entity",className:"spot-form-select",value:l.entityId,onChange:p=>i(r=>({...r,entityId:p.target.value})),children:[e.jsx("option",{value:"",children:"Selectionner une entite"}),c.map(p=>e.jsxs("option",{value:p.id,children:[te[p.type]," ",p.name]},p.id))]})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"target-position",children:"Position"}),e.jsx("select",{id:"target-position",className:"spot-form-select",value:l.position,onChange:p=>i(r=>({...r,position:parseInt(p.target.value)})),children:[-2,-1,0,1,2].map(p=>e.jsxs("option",{value:p,children:[je[p]," ",fe[p]]},p))})]})]}),e.jsxs("div",{className:"spot-form-row",children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",children:"Influence (1-5)"}),e.jsx("input",{type:"range",min:"1",max:"5",value:l.influence,onChange:p=>i(r=>({...r,influence:parseInt(p.target.value)})),className:"spot-range"}),e.jsx("span",{className:"spot-range-value",children:l.influence})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"target-access",children:"Acces"}),e.jsx("select",{id:"target-access",className:"spot-form-select",value:l.access,onChange:p=>i(r=>({...r,access:p.target.value})),children:ve.map(p=>e.jsx("option",{value:p.value,children:p.label},p.value))})]})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"target-notes",children:"Notes"}),e.jsx("input",{type:"text",id:"target-notes",className:"spot-form-input",value:l.notes,onChange:p=>i(r=>({...r,notes:p.target.value})),placeholder:"Notes supplementaires..."})]}),e.jsx("button",{className:"spot-btn spot-btn-primary",onClick:b,children:"Ajouter la cible"})]})]})}function We({data:t,onSave:c}){const[a,l]=n.useState({title:"",description:"",responsible:"",deadline:"",status:"planned"}),[i,j]=n.useState(null),b=n.useRef(null),s=t||[],m=()=>{a.title.trim()&&(i?(c(s.map(N=>N.id===i?{...N,...a}:N)),j(null)):c([...s,{id:Date.now(),...a}]),l({title:"",description:"",responsible:"",deadline:"",status:"planned"}))},p=N=>{l({title:N.title,description:N.description,responsible:N.responsible,deadline:N.deadline,status:N.status}),j(N.id)},r=N=>{c(s.filter(f=>f.id!==N))},d=()=>{const N=["Titre","Description","Responsable","Ã‰cheance","Statut"],f=s.map(g=>[g.title,g.description||"",g.responsible||"",g.deadline||"",g.status]),E=[N,...f].map(g=>g.map(k=>`"${String(k).replace(/"/g,'""')}"`).join(",")).join(`
`);S(E,"actions.csv","text/csv")},h=()=>{const N=JSON.stringify(s,null,2);S(N,"actions.json","application/json")},S=(N,f,E)=>{const g=new Blob([N],{type:E}),k=URL.createObjectURL(g),C=document.createElement("a");C.href=k,C.download=f,C.click(),URL.revokeObjectURL(k)},R=N=>{const f=N.target.files?.[0];if(!f)return;const E=new FileReader;E.onload=g=>{try{const k=g.target?.result;if(f.name.endsWith(".json")){const C=JSON.parse(k);c([...s,...C])}else if(f.name.endsWith(".csv")){const C=k.split(`
`),_=C[0].split(",").map(M=>M.replace(/"/g,"").trim()),q=C.slice(1).filter(M=>M.trim()).map((M,U)=>{const Y=M.split(",").map(G=>G.replace(/"/g,"").trim());return{id:Date.now()+U,title:Y[_.indexOf("Titre")]||"",description:Y[_.indexOf("Description")]||"",responsible:Y[_.indexOf("Responsable")]||"",deadline:Y[_.indexOf("Ã‰cheance")]||"",status:Y[_.indexOf("Statut")]||"planned"}});c([...s,...q])}}catch(k){console.error("Import error:",k)}},E.readAsText(f),b.current&&(b.current.value="")},P=(N,f)=>{c(s.map(E=>E.id===N?{...E,status:f}:E))},O={planned:s.filter(N=>N.status==="planned"),ongoing:s.filter(N=>N.status==="ongoing"),completed:s.filter(N=>N.status==="completed")};return e.jsxs("div",{className:"spot-section",children:[e.jsxs("div",{className:"spot-section-header",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"spot-section-title",children:"Plan d'Action"}),e.jsx("p",{className:"spot-section-desc",children:"Planifiez et suivez vos actions de plaidoyer."})]}),e.jsxs("div",{className:"spot-section-toolbar",children:[e.jsxs("button",{className:"spot-toolbar-btn",onClick:d,title:"Exporter en CSV",children:[e.jsx(xe,{size:18}),"CSV"]}),e.jsxs("button",{className:"spot-toolbar-btn",onClick:h,title:"Exporter en JSON",children:[e.jsx(xe,{size:18}),"JSON"]}),e.jsxs("button",{className:"spot-toolbar-btn",onClick:()=>b.current?.click(),title:"Importer",children:[e.jsx(Ce,{size:18}),"Importer"]}),e.jsx("input",{ref:b,type:"file",accept:".json,.csv",onChange:R,style:{display:"none"}})]})]}),e.jsx("div",{className:"spot-actions-board",children:pe.map(N=>e.jsxs("div",{className:"spot-actions-column",children:[e.jsxs("h4",{className:"spot-actions-column-title",children:[N.label," ",e.jsxs("span",{className:"spot-actions-count",children:["(",O[N.value]?.length||0,")"]})]}),e.jsx("div",{className:"spot-actions-list",children:O[N.value]?.map(f=>e.jsxs("div",{className:"spot-action-card",children:[e.jsxs("div",{className:"spot-action-header",children:[e.jsx("h5",{className:"spot-action-title",children:f.title}),e.jsxs("div",{className:"spot-action-buttons",children:[e.jsx("button",{className:"spot-action-btn spot-action-edit",onClick:()=>p(f),title:"Modifier",children:"âœŽ"}),e.jsx("button",{className:"spot-action-btn spot-action-delete",onClick:()=>r(f.id),title:"Supprimer",children:"âœ•"})]})]}),f.description&&e.jsx("p",{className:"spot-action-desc",children:f.description}),e.jsxs("div",{className:"spot-action-meta",children:[f.responsible&&e.jsx("span",{className:"spot-action-meta-item spot-action-responsible",children:f.responsible}),f.deadline&&e.jsx("span",{className:"spot-action-meta-item spot-action-deadline",children:f.deadline})]}),e.jsx("select",{className:"spot-action-status-select",value:f.status,onChange:E=>P(f.id,E.target.value),children:pe.map(E=>e.jsx("option",{value:E.value,children:E.label},E.value))})]},f.id))})]},N.value))}),e.jsxs("div",{className:"spot-add-form",children:[e.jsx("h4",{children:i?"Modifier l'action":"Nouvelle action"}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"action-title",children:"Titre *"}),e.jsx("input",{type:"text",id:"action-title",className:"spot-form-input",value:a.title,onChange:N=>l(f=>({...f,title:N.target.value})),placeholder:"Titre de l'action..."})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"action-desc",children:"Description"}),e.jsx("textarea",{id:"action-desc",className:"spot-form-textarea",value:a.description,onChange:N=>l(f=>({...f,description:N.target.value})),placeholder:"Description detaillee...",rows:2})]}),e.jsxs("div",{className:"spot-form-row",children:[e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"action-responsible",children:"Responsable"}),e.jsx("input",{type:"text",id:"action-responsible",className:"spot-form-input",value:a.responsible,onChange:N=>l(f=>({...f,responsible:N.target.value})),placeholder:"Qui est responsable ?"})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"action-deadline",children:"Echeance"}),e.jsx("input",{type:"text",id:"action-deadline",className:"spot-form-input",value:a.deadline,onChange:N=>l(f=>({...f,deadline:N.target.value})),placeholder:"Date ou periode..."})]}),e.jsxs("div",{className:"spot-form-group",children:[e.jsx("label",{className:"spot-form-label",htmlFor:"action-status",children:"Statut"}),e.jsx("select",{id:"action-status",className:"spot-form-select",value:a.status,onChange:N=>l(f=>({...f,status:N.target.value})),children:pe.map(N=>e.jsx("option",{value:N.value,children:N.label},N.value))})]})]}),e.jsx("button",{className:"spot-btn spot-btn-primary",onClick:m,children:i?"Modifier":"Ajouter"}),i&&e.jsx("button",{className:"spot-btn",onClick:()=>{j(null),l({title:"",description:"",responsible:"",deadline:"",status:"planned"})},children:"Annuler"})]})]})}const Xe=[{id:"toc",label:"Theorie du Changement",icon:"ðŸŽ¯"},{id:"swot",label:"SWOT",icon:"ðŸ“Š"},{id:"pestel",label:"PESTEL",icon:"ðŸŒ"},{id:"tree",label:"Arbre a Problemes",icon:"ðŸŒ³"},{id:"fiveWhy",label:"5 Pourquoi",icon:"â“"},{id:"objectives",label:"Objectifs",icon:"ðŸŽ¯"},{id:"strategies",label:"Strategies",icon:"â™Ÿï¸"},{id:"messages",label:"Messages",icon:"ðŸ’¬"},{id:"targets",label:"Cibles",icon:"ðŸŽ¯"},{id:"actions",label:"Actions",icon:"âœ…"}];function Ke({plaidoyer:t,entities:c,onUpdateField:a,onSave:l}){const[i,j]=n.useState("toc"),b=()=>{switch(i){case"toc":return e.jsx(Pe,{data:t.toc,onUpdate:(s,m)=>a("toc",s,m)});case"swot":return e.jsx(qe,{data:t.swot,onUpdate:(s,m)=>a("swot",s,m)});case"pestel":return e.jsx($e,{data:t.pestel,onUpdate:(s,m)=>a("pestel",s,m)});case"tree":return e.jsx(Le,{data:t.tree,onUpdate:(s,m)=>a("tree",s,m)});case"fiveWhy":return e.jsx(ze,{data:t.fiveWhy,onSave:s=>l({...t,fiveWhy:s})});case"objectives":return e.jsx(Be,{data:t.objectives,onSave:s=>l({...t,objectives:s})});case"strategies":return e.jsx(Ye,{data:t.strategies,onSave:s=>l({...t,strategies:s})});case"messages":return e.jsx(Je,{data:t.messages,onSave:s=>l({...t,messages:s})});case"targets":return e.jsx(Ve,{data:t.targets,entities:c,onSave:s=>l({...t,targets:s})});case"actions":return e.jsx(We,{data:t.actions,onSave:s=>l({...t,actions:s})});default:return null}};return e.jsxs("div",{className:"spot-plaidoyer-layout",children:[e.jsx("div",{className:"spot-plaidoyer-sidebar",children:e.jsx("div",{className:"spot-plaid-nav-group",children:Xe.map(s=>e.jsxs("button",{className:`spot-plaid-nav-item ${i===s.id?"active":""}`,onClick:()=>j(s.id),children:[e.jsx("span",{className:"emoji",children:s.icon}),e.jsx("span",{className:"spot-plaid-nav-item-label",children:s.label})]},s.id))})}),e.jsx("div",{className:"spot-plaidoyer-content",children:b()})]})}const ye="https://wzntekbylulhwsveugkc.supabase.co/functions/v1/sync-ep-associations";function Ue(){const[t,c]=n.useState([]),[a,l]=n.useState(!0),[i,j]=n.useState(null),[b,s]=n.useState(0),[m,p]=n.useState(!1),[r,d]=n.useState({search:"",province:"",type:""}),h=n.useCallback(async()=>{try{l(!0);let f=T.from("ep_associations").select("*",{count:"exact"});r.search&&(f=f.ilike("denomination",`%${r.search}%`)),r.province&&(f=f.eq("province",r.province)),r.type&&(f=f.eq("type_reconnaissance",r.type)),f=f.order("denomination",{ascending:!0});const{data:E,error:g,count:k}=await f;if(g)throw g;c(E||[]),s(k||0),j(null)}catch(f){console.error("Error fetching associations:",f),j(f.message)}finally{l(!1)}},[r]),S=n.useCallback(async(f=100,E=0)=>{try{l(!0);const g=new URLSearchParams({action:"fetch",limit:f.toString(),offset:E.toString()});r.search&&g.append("search",r.search),r.province&&g.append("province",r.province);const k=await fetch(`${ye}?${g}`,{headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6bnRla2J5bHVsaHdzdmV1Z2tjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NzExNDgsImV4cCI6MjA4MzA0NzE0OH0.gJXVOBL8EOMKFWC3Mo1IjxEYMEeBPAb_GTQc-0uOCZ0","Content-Type":"application/json"}});if(!k.ok)throw new Error("Failed to fetch from API");const C=await k.json();c(C.associations||[]),s(C.total||0),j(null)}catch(g){console.error("Error fetching from API:",g),j(g.message)}finally{l(!1)}},[r]),R=n.useCallback(async()=>{try{p(!0);const f=await fetch(`${ye}?action=sync`,{headers:{Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Ind6bnRla2J5bHVsaHdzdmV1Z2tjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NzExNDgsImV4cCI6MjA4MzA0NzE0OH0.gJXVOBL8EOMKFWC3Mo1IjxEYMEeBPAb_GTQc-0uOCZ0","Content-Type":"application/json"}});if(!f.ok)throw new Error("Sync failed");const E=await f.json();return await h(),E}catch(f){throw console.error("Sync error:",f),j(f.message),f}finally{p(!1)}},[h]),P=n.useCallback(()=>[...new Set(t.map(E=>E.province).filter(Boolean))].sort(),[t]),O=n.useCallback(()=>[...new Set(t.map(E=>E.type_reconnaissance).filter(Boolean))].sort(),[t]),N=n.useCallback(()=>{const f={},E={};return t.forEach(g=>{g.province&&(f[g.province]=(f[g.province]||0)+1),g.type_reconnaissance&&(E[g.type_reconnaissance]=(E[g.type_reconnaissance]||0)+1)}),{byProvince:f,byType:E,total:t.length}},[t]);return n.useEffect(()=>{h()},[h]),{associations:t,loading:a,error:i,total:b,syncing:m,filters:r,setFilters:d,fetchFromDatabase:h,fetchFromAPI:S,syncFromODWB:R,getProvinces:P,getTypes:O,getStats:N}}const Ge=["Bruxelles-Capitale","Brabant Wallon","Hainaut","LiÃ¨ge","Luxembourg","Namur"];function Ze({association:t,onSelect:c,isSelected:a}){return e.jsxs("article",{className:`spot-ep-card ${a?"selected":""}`,onClick:()=>c(t),role:"button",tabIndex:0,onKeyDown:l=>l.key==="Enter"&&c(t),"aria-selected":a,children:[e.jsx("h3",{className:"spot-ep-card-title",children:t.denomination}),e.jsxs("div",{className:"spot-ep-card-meta",children:[e.jsxs("span",{className:"spot-ep-card-location",children:[t.localite," (",t.province,")"]}),t.type_reconnaissance&&e.jsx("span",{className:"spot-ep-card-type",children:t.type_reconnaissance})]}),t.objectifs&&e.jsxs("p",{className:"spot-ep-card-desc",children:[t.objectifs.substring(0,150),"..."]}),t.mots_cles?.length>0&&e.jsx("div",{className:"spot-ep-card-tags",children:t.mots_cles.slice(0,3).map((l,i)=>e.jsx("span",{className:"spot-ep-tag",children:l},i))})]})}function He({association:t,onClose:c,onAddToEntities:a}){const l=n.useId();return t?e.jsxs("aside",{className:"spot-ep-detail",role:"region","aria-labelledby":l,children:[e.jsxs("header",{className:"spot-ep-detail-header",children:[e.jsx("h2",{id:l,children:t.denomination}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm",onClick:c,"aria-label":"Fermer les details",children:"Fermer"})]}),e.jsxs("div",{className:"spot-ep-detail-content",children:[e.jsxs("section",{className:"spot-ep-section",children:[e.jsx("h3",{children:"Coordonnees"}),t.adresse&&e.jsx("p",{children:t.adresse}),e.jsxs("p",{children:[t.code_postal," ",t.localite]}),e.jsx("p",{children:t.province}),t.telephone&&e.jsx("p",{children:e.jsx("a",{href:`tel:${t.telephone}`,children:t.telephone})}),t.courriel&&e.jsx("p",{children:e.jsx("a",{href:`mailto:${t.courriel}`,children:t.courriel})}),t.site_web&&e.jsx("p",{children:e.jsx("a",{href:t.site_web,target:"_blank",rel:"noopener noreferrer",children:"Site web"})})]}),e.jsxs("section",{className:"spot-ep-section",children:[e.jsx("h3",{children:"Informations"}),e.jsxs("dl",{className:"spot-ep-info",children:[e.jsx("dt",{children:"Statut juridique"}),e.jsx("dd",{children:t.statut_juridique||"Non specifie"}),e.jsx("dt",{children:"Type de reconnaissance"}),e.jsx("dd",{children:t.type_reconnaissance||"Non specifie"}),t.bce&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"BCE"}),e.jsx("dd",{children:t.bce})]}),t.bassin_de_vie&&e.jsxs(e.Fragment,{children:[e.jsx("dt",{children:"Bassin de vie"}),e.jsx("dd",{children:t.bassin_de_vie})]})]})]}),t.objectifs&&e.jsxs("section",{className:"spot-ep-section",children:[e.jsx("h3",{children:"Objectifs"}),e.jsx("p",{children:t.objectifs})]}),t.mots_cles?.length>0&&e.jsxs("section",{className:"spot-ep-section",children:[e.jsx("h3",{children:"Mots-cles"}),e.jsx("div",{className:"spot-ep-tags-list",children:t.mots_cles.map((i,j)=>e.jsx("span",{className:"spot-ep-tag",children:i},j))})]}),t.latitude&&t.longitude&&e.jsxs("section",{className:"spot-ep-section",children:[e.jsx("h3",{children:"Localisation"}),e.jsx("a",{href:`https://www.openstreetmap.org/?mlat=${t.latitude}&mlon=${t.longitude}#map=15/${t.latitude}/${t.longitude}`,target:"_blank",rel:"noopener noreferrer",className:"spot-btn spot-btn-sm",children:"Voir sur la carte"})]}),e.jsx("div",{className:"spot-ep-actions",children:e.jsx("button",{type:"button",className:"spot-btn spot-btn-primary",onClick:()=>a(t),children:"Ajouter aux entites mySPOT"})})]})]}):null}function Qe({onAddEntity:t}){const{associations:c,loading:a,error:l,total:i,syncing:j,filters:b,setFilters:s,syncFromODWB:m,getStats:p}=Ue(),[r,d]=n.useState(null),[h,S]=n.useState("list"),R=n.useId(),P=n.useMemo(()=>p(),[p]),O=g=>{s(k=>({...k,search:g.target.value}))},N=g=>{s(k=>({...k,province:g.target.value}))},f=async()=>{try{const g=await m();alert(`Synchronisation terminee: ${g.synced} associations importees`)}catch{alert("Erreur lors de la synchronisation")}},E=g=>{t&&(t({name:g.denomination,type:"organization",alias:g.bce||"",desc:g.objectifs||"",tags:g.mots_cles||[],role:"target"}),alert(`"${g.denomination}" ajoute aux entites`))};return a&&c.length===0?e.jsx("div",{className:"spot-ep-loading",role:"status","aria-live":"polite",children:e.jsx("div",{className:"spot-loader",children:"Chargement du repertoire EP..."})}):l?e.jsxs("div",{className:"spot-ep-error",role:"alert",children:[e.jsxs("p",{children:["Erreur: ",l]}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-primary",onClick:m,children:"Synchroniser depuis ODWB"})]}):e.jsxs("div",{className:"spot-ep-directory",children:[e.jsxs("header",{className:"spot-ep-header",children:[e.jsxs("div",{className:"spot-ep-title-row",children:[e.jsx("h2",{children:"Repertoire Education Permanente"}),e.jsxs("span",{className:"spot-ep-count",children:[i," associations"]})]}),e.jsxs("div",{className:"spot-ep-controls",children:[e.jsxs("div",{className:"spot-ep-search",children:[e.jsx("label",{htmlFor:R,className:"spot-sr-only",children:"Rechercher"}),e.jsx("input",{id:R,type:"search",className:"spot-form-input",placeholder:"Rechercher une association...",value:b.search,onChange:O})]}),e.jsxs("select",{className:"spot-form-select",value:b.province,onChange:N,"aria-label":"Filtrer par province",children:[e.jsx("option",{value:"",children:"Toutes les provinces"}),Ge.map(g=>e.jsx("option",{value:g,children:g},g))]}),e.jsxs("div",{className:"spot-ep-view-toggle",role:"group","aria-label":"Mode d'affichage",children:[e.jsx("button",{type:"button",className:`spot-btn spot-btn-sm ${h==="list"?"active":""}`,onClick:()=>S("list"),"aria-pressed":h==="list",children:"Liste"}),e.jsx("button",{type:"button",className:`spot-btn spot-btn-sm ${h==="stats"?"active":""}`,onClick:()=>S("stats"),"aria-pressed":h==="stats",children:"Stats"})]}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-sm",onClick:f,disabled:j,children:j?"Sync...":"Sync ODWB"})]})]}),e.jsx("div",{className:"spot-ep-content",children:h==="list"?e.jsxs("div",{className:"spot-ep-list-view",children:[e.jsxs("div",{className:"spot-ep-list",role:"list",children:[c.map(g=>e.jsx(Ze,{association:g,onSelect:d,isSelected:r?.id===g.id},g.id||g.denomination)),c.length===0&&e.jsxs("div",{className:"spot-ep-empty",role:"status",children:[e.jsx("p",{children:"Aucune association trouvee"}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-primary",onClick:f,children:"Synchroniser depuis ODWB"})]})]}),e.jsx(He,{association:r,onClose:()=>d(null),onAddToEntities:E})]}):e.jsxs("div",{className:"spot-ep-stats-view",children:[e.jsxs("section",{className:"spot-ep-stats-section",children:[e.jsx("h3",{children:"Par province"}),e.jsx("div",{className:"spot-ep-stats-grid",children:Object.entries(P.byProvince).sort((g,k)=>k[1]-g[1]).map(([g,k])=>e.jsxs("div",{className:"spot-ep-stat-card",children:[e.jsx("span",{className:"spot-ep-stat-value",children:k}),e.jsx("span",{className:"spot-ep-stat-label",children:g})]},g))})]}),e.jsxs("section",{className:"spot-ep-stats-section",children:[e.jsx("h3",{children:"Par type de reconnaissance"}),e.jsx("div",{className:"spot-ep-stats-list",children:Object.entries(P.byType).sort((g,k)=>k[1]-g[1]).map(([g,k])=>e.jsxs("div",{className:"spot-ep-stat-row",children:[e.jsx("span",{className:"spot-ep-stat-type",children:g}),e.jsx("span",{className:"spot-ep-stat-count",children:k})]},g))})]})]})}),e.jsx("footer",{className:"spot-ep-footer",children:e.jsxs("p",{children:["Donnees: ",e.jsx("a",{href:"https://www.odwb.be/explore/dataset/l-education-permanente-en-federation-wallonie-bruxelles",target:"_blank",rel:"noopener noreferrer",children:"Open Data Wallonie Bruxelles"})]})})]})}const ee=[{id:"entities",label:"Entites",icon:"E"},{id:"graph",label:"Graphe",icon:"G"},{id:"plaidoyer",label:"Plaidoyer",icon:"P"},{id:"ep",label:"Repertoire EP",icon:"R"},{id:"export",label:"Export",icon:"X"}];function tt(){const t=ke(),[c,a]=n.useState("entities"),[l,i]=n.useState(null),j=n.useId(),b=n.useCallback((o,x)=>{let v=x;switch(o.key){case"ArrowDown":o.preventDefault(),v=(x+1)%ee.length;break;case"ArrowUp":o.preventDefault(),v=x===0?ee.length-1:x-1;break;case"Home":o.preventDefault(),v=0;break;case"End":o.preventDefault(),v=ee.length-1;break;default:return}a(ee[v].id),document.getElementById(`nav-${ee[v].id}`)?.focus()},[]),[s,m]=n.useState(!1),[p,r]=n.useState(null),[d,h]=n.useState(!1),[S,R]=n.useState(null),[P,O]=n.useState(null),[N,f]=n.useState(!1),[E,g]=n.useState(null),k=n.useCallback(o=>{i(o)},[]),C=n.useCallback(()=>{r(null),m(!0)},[]),_=n.useCallback(o=>{r(o),m(!0)},[]),q=n.useCallback(async(o,x)=>{try{if(x)await t.updateEntity(x,o),l?.id===x&&i(v=>({...v,...o}));else{const v=await t.addEntity(o);i(v)}}catch(v){console.error("Error saving entity:",v)}},[t,l]),M=n.useCallback(async o=>{try{await t.deleteEntity(o),l?.id===o&&i(null)}catch(x){console.error("Error deleting entity:",x)}},[t,l]),U=n.useCallback(o=>{R(null),O(o),h(!0)},[]),Y=n.useCallback(o=>{R(o),O(null),h(!0)},[]),G=n.useCallback(async(o,x)=>{try{x?await t.updateRelation(x,o):await t.addRelation(o)}catch(v){console.error("Error saving relation:",v)}},[t]),Z=n.useCallback(async o=>{try{await t.deleteRelation(o)}catch(x){console.error("Error deleting relation:",x)}},[t]),Q=n.useCallback(()=>{g(null),f(!0)},[]),u=n.useCallback(o=>{g(o),f(!0)},[]),y=n.useCallback(async(o,x)=>{try{x?await t.updateNote(x,{content:o.content,source:o.source}):await t.addNote(o)}catch(v){console.error("Error saving note:",v)}},[t]),w=n.useCallback(async o=>{try{await t.deleteNote(o)}catch(x){console.error("Error deleting note:",x)}},[t]),D=n.useCallback(()=>{const o=t.exportData(),x=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),v=URL.createObjectURL(x),I=document.createElement("a");I.href=v,I.download=`myspot-export-${new Date().toISOString().split("T")[0]}.json`,I.click(),URL.revokeObjectURL(v)},[t]),F=n.useCallback(async o=>{const x=o.target.files?.[0];if(x){try{const v=await x.text(),I=JSON.parse(v),z=await t.importData(I);alert(`Import termine: ${z.entities} entites, ${z.relations} relations, ${z.notes} notes`)}catch(v){console.error("Import error:",v),alert("Erreur lors de l'import")}o.target.value=""}},[t]),J=n.useCallback(async()=>{window.confirm("Supprimer toutes les donnees ? Cette action est irreversible.")&&(await t.resetData(),i(null))},[t]),de=l?t.getEntityRelations(l.id):[],se=l?t.getEntityNotes(l.id):[],oe=t.getStats();return t.loading?e.jsx("div",{className:"spot-app spot-loading",children:e.jsx("div",{className:"spot-loader",children:"Chargement..."})}):t.error?e.jsxs("div",{className:"spot-app spot-error",children:[e.jsxs("p",{children:["Erreur: ",t.error]}),e.jsx("button",{className:"spot-btn spot-btn-primary",onClick:t.reload,children:"Reessayer"})]}):e.jsxs("div",{className:"spot-app",children:[e.jsxs("aside",{className:"spot-sidebar","aria-label":"Navigation principale",children:[e.jsxs("div",{className:"spot-logo",children:[e.jsx("span",{className:"spot-logo-icon","aria-hidden":"true",children:"S"}),e.jsx("span",{className:"spot-logo-text",children:"mySPOT"})]}),e.jsx("nav",{className:"spot-nav",role:"tablist","aria-label":"Vues principales",children:ee.map((o,x)=>e.jsxs("button",{id:`nav-${o.id}`,type:"button",role:"tab","aria-selected":c===o.id,"aria-controls":j,tabIndex:c===o.id?0:-1,className:`spot-nav-item ${c===o.id?"active":""}`,onClick:()=>a(o.id),onKeyDown:v=>b(v,x),children:[e.jsx("span",{className:"spot-nav-icon","aria-hidden":"true",children:o.icon}),e.jsx("span",{className:"spot-nav-label",children:o.label})]},o.id))}),e.jsxs("div",{className:"spot-sidebar-stats","aria-label":"Statistiques",children:[e.jsxs("div",{className:"spot-stat",children:[e.jsx("span",{className:"spot-stat-value",children:oe.totalEntities}),e.jsx("span",{className:"spot-stat-label",children:"entites"})]}),e.jsxs("div",{className:"spot-stat",children:[e.jsx("span",{className:"spot-stat-value",children:oe.totalRelations}),e.jsx("span",{className:"spot-stat-label",children:"relations"})]})]})]}),e.jsxs("main",{className:"spot-main",id:j,role:"tabpanel","aria-label":`Vue ${ee.find(o=>o.id===c)?.label}`,children:[c==="entities"&&e.jsxs("div",{className:"spot-entities-view",children:[e.jsx(Ee,{entities:t.entities,selectedId:l?.id,onSelect:k,onAdd:C}),e.jsx(De,{entity:l,relations:de,notes:se,entities:t.entities,onEdit:_,onAddRelation:U,onEditRelation:Y,onDeleteRelation:Z,onAddNote:Q,onEditNote:u,onDeleteNote:w,onSelectEntity:k})]}),c==="graph"&&e.jsx(Me,{entities:t.entities,relations:t.relations,selectedId:l?.id,onSelectEntity:k,onAddEntity:C}),c==="plaidoyer"&&e.jsx(Ke,{plaidoyer:t.plaidoyer,entities:t.entities,onUpdateField:t.updatePlaidoyerField,onSave:t.savePlaidoyer}),c==="ep"&&e.jsx(Qe,{onAddEntity:q}),c==="export"&&e.jsxs("div",{className:"spot-export-view",role:"region","aria-labelledby":"export-heading",children:[e.jsx("h2",{id:"export-heading",className:"spot-section-title",children:"Gestion des donnees"}),e.jsxs("div",{className:"spot-export-actions",children:[e.jsxs("section",{className:"spot-export-card","aria-labelledby":"export-title",children:[e.jsx("h3",{id:"export-title",children:"Exporter"}),e.jsx("p",{children:"Telecharger toutes vos donnees au format JSON."}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-primary",onClick:D,children:"Exporter les donnees"})]}),e.jsxs("section",{className:"spot-export-card","aria-labelledby":"import-title",children:[e.jsx("h3",{id:"import-title",children:"Importer"}),e.jsx("p",{children:"Charger des donnees depuis un fichier JSON."}),e.jsxs("label",{className:"spot-btn spot-btn-primary",tabIndex:"0",onKeyDown:o=>o.key==="Enter"&&o.target.querySelector("input")?.click(),children:["Importer des donnees",e.jsx("input",{type:"file",accept:".json",onChange:F,className:"spot-sr-only","aria-label":"Choisir un fichier JSON a importer"})]})]}),e.jsxs("section",{className:"spot-export-card spot-export-danger","aria-labelledby":"reset-title",children:[e.jsx("h3",{id:"reset-title",children:"Reinitialiser"}),e.jsx("p",{children:"Supprimer toutes les donnees. Cette action est irreversible."}),e.jsx("button",{type:"button",className:"spot-btn spot-btn-danger",onClick:J,children:"Reinitialiser"})]})]})]})]}),e.jsx(Fe,{isOpen:s,onClose:()=>m(!1),entity:p,onSave:q,onDelete:M}),e.jsx(Te,{isOpen:d,onClose:()=>h(!1),relation:S,entities:t.entities,fromEntity:P,onSave:G,onDelete:Z}),e.jsx(Oe,{isOpen:N,onClose:()=>f(!1),note:E,entityId:l?.id,onSave:y,onDelete:w})]})}export{tt as MySPOT};
